<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LUXIOU | å…¨æ¯è¯Šæ–­ç³»ç»Ÿ</title>
    <style>
        :root { --primary: #00f2fe; --accent: #00ff88; --bg: #0b0f19; --panel: rgba(16, 24, 39, 0.8); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #e2e8f0; font-family: -apple-system, sans-serif; margin: 0; padding: 0; overflow-x: hidden; }
        
        .back-btn { position: fixed; top: 15px; left: 15px; z-index: 5000; background: rgba(0,0,0,0.6); color: #fff; padding: 10px 18px; border-radius: 50px; text-decoration: none; font-size: 13px; border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px); }

        .app-container { width: 100vw; height: 100vh; display: flex; flex-direction: column; padding: 15px; padding-top: 65px; background: radial-gradient(circle at center, #1a2234 0%, #0b0f19 100%); }

        /* é¡¶éƒ¨ç´§å‡‘å¯¼èˆª */
        .category-box { display: flex; gap: 8px; overflow-x: auto; margin-bottom: 15px; scrollbar-width: none; }
        .cat-item { flex: 0 0 auto; padding: 6px 15px; background: #161e2e; border-radius: 10px; font-size: 11px; color: #556075; border: 1px solid #333; }
        .cat-item.active { background: var(--primary); color: #000; font-weight: bold; box-shadow: 0 0 15px var(--primary); }

        /* ã€æ ¸å¿ƒé‡æ„ã€‘å¤§å±å›¾ç‰‡æ˜¾ç¤ºåŒº */
        .stage-area { position: relative; flex: 1; width: 100%; display: flex; justify-content: space-between; align-items: stretch; gap: 5px; margin-bottom: 15px; }

        /* å·¦å³å‚æ•°ï¼šæè‡´å‹ç¼©å®½åº¦ */
        .params-side { flex: 0 0 85px; display: flex; flex-direction: column; z-index: 100; }
        .param-card { flex: 1; background: rgba(11, 15, 25, 0.7); border: 0.5px solid rgba(255,255,255,0.1); padding: 5px; display: flex; flex-direction: column; justify-content: center; backdrop-filter: blur(5px); }
        .card-l { border-left: 3px solid #fff; }
        .card-r { border-right: 3px solid var(--primary); text-align: right; }
        .param-card label { font-size: 9px; color: #888; display: block; transform: scale(0.9); }
        .param-card b { font-size: 15px; color: var(--primary); font-weight: 900; display: block; }
        .diff-tag { font-size: 10px; color: var(--accent); font-weight: bold; }

        /* å›¾ç‰‡è§†çª—ï¼šå¤§å±åŒ– */
        .main-viewer { flex: 1; background: #000; border-radius: 15px; position: relative; overflow: hidden; border: 1px solid #333; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .img-layer { position: absolute; width: 100%; height: 100%; background-size: cover; background-position: center; transition: 0.3s; }
        #laserCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; cursor: crosshair; }

        /* æ§åˆ¶åŒº */
        .control-panel { background: var(--panel); border-radius: 20px; padding: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .slider-wrap { margin-bottom: 15px; }
        .slider-label { display: flex; justify-content: space-between; font-size: 10px; color: var(--primary); font-weight: bold; margin-bottom: 8px; }
        input[type=range] { width: 100%; -webkit-appearance: none; background: #1a2234; height: 4px; border-radius: 2px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; background: #fff; border: 3px solid var(--primary); border-radius: 50%; box-shadow: 0 0 10px var(--primary); }

        .btn-grid { display: grid; grid-template-columns: 1fr 1fr 1.2fr; gap: 8px; }
        .lux-btn { background: #1a2234; border: 1px solid #333; padding: 12px 5px; border-radius: 10px; color: #fff; font-size: 11px; font-weight: bold; text-align: center; }
        .btn-save { background: var(--primary); color: #000; border: none; box-shadow: 0 0 15px var(--primary); }

        #archiveBox { height: 100px; overflow-y: auto; margin-top: 10px; font-size: 11px; }
    </style>
</head>
<body>
    <a href="./index.html" class="back-btn">è¿”å›</a>
    <div class="app-container">
        <div class="category-box">
            <div class="cat-item active" onclick="loadSetup('posture')">ä½“æ€çŸ«æ­£</div>
            <div class="cat-item" onclick="loadSetup('shoulder')">ç›´è§’è‚©</div>
            <div class="cat-item" onclick="loadSetup('muscle')">å¢è‚Œ</div>
        </div>

        <div class="stage-area">
            <div class="params-side" id="colL"></div>
            <div class="main-viewer">
                <div class="img-layer" id="layB" style="background-image:url('case_before.jpg'); opacity:1;"></div>
                <div class="img-layer" id="layA" style="background-image:url('case_after.jpg'); opacity:0;"></div>
                <canvas id="laserCanvas"></canvas>
            </div>
            <div class="params-side" id="colR"></div>
        </div>

        <div class="control-panel">
            <div class="slider-wrap">
                <div class="slider-label"><span>BEFORE</span><span>æ»‘åŠ¨å¯¹æ¯”å¹¶æ‰‹åŠ¨å¾®è°ƒé”šç‚¹</span><span>AFTER</span></div>
                <input type="range" min="0" max="100" value="0" id="fadeSlider">
            </div>
            <div class="btn-grid">
                <div class="lux-btn" onclick="document.getElementById('fB').click()">ğŸ“· å‰ç…§<input type="file" id="fB" hidden onchange="processImg(this,'layB')"></div>
                <div class="lux-btn" onclick="document.getElementById('fA').click()">ğŸ“· åç…§<input type="file" id="fA" hidden onchange="processImg(this,'layA')"></div>
                <div class="lux-btn btn-save" onclick="saveData()">ğŸ’¾ ä¿å­˜å…¨æ¯å­˜æ¡£</div>
            </div>
            <div id="archiveBox"></div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('laserCanvas');
        const ctx = canvas.getContext('2d');
        // æ™ºèƒ½è‡ªåŠ¨æ ¡æ­£ï¼šåˆå§‹è½ç‚¹ç®—æ³• [èº«ä½“æ ¸å¿ƒè§£å‰–ä½ç™¾åˆ†æ¯”]
        let anchors = [0.15, 0.25, 0.40, 0.55, 0.70, 0.85]; 
        let draggingIdx = -1;

        function draw() {
            canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            anchors.forEach((yPct, i) => {
                const boxY = (i * (canvas.height / 6)) + (canvas.height / 12);
                const targetY = canvas.height * yPct;
                
                // ç»˜åˆ¶æ¿€å…‰çº¿
                ctx.strokeStyle = "rgba(0, 242, 254, 0.5)"; ctx.lineWidth = 1; ctx.setLineDash([5, 5]);
                ctx.beginPath(); ctx.moveTo(0, boxY); ctx.lineTo(canvas.width*0.5, targetY); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(canvas.width, boxY); ctx.lineTo(canvas.width*0.5, targetY); ctx.stroke();
                
                // ç»˜åˆ¶å¯ç§»åŠ¨é”šç‚¹
                ctx.setLineDash([]); ctx.fillStyle = draggingIdx === i ? "#fff" : "#00ff88";
                ctx.shadowBlur = 10; ctx.shadowColor = "#00f2fe";
                ctx.beginPath(); ctx.arc(canvas.width*0.5, targetY, 6, 0, Math.PI*2); ctx.fill();
                ctx.shadowBlur = 0;
            });
        }

        // äº¤äº’é€»è¾‘ï¼šæ”¯æŒæ‹–æ‹½å¾®è°ƒ
        const getEvY = e => (e.touches ? e.touches[0].clientY : e.clientY) - canvas.getBoundingClientRect().top;
        const handleStart = e => { draggingIdx = anchors.findIndex(a => Math.abs(a - getEvY(e)/canvas.height) < 0.05); };
        const handleMove = e => { if(draggingIdx !== -1) { anchors[draggingIdx] = Math.max(0, Math.min(1, getEvY(e)/canvas.height)); draw(); } };
        
        canvas.addEventListener('mousedown', handleStart); canvas.addEventListener('mousemove', handleMove);
        canvas.addEventListener('mouseup', () => draggingIdx = -1);
        canvas.addEventListener('touchstart', handleStart); canvas.addEventListener('touchmove', handleMove);
        canvas.addEventListener('touchend', () => draggingIdx = -1);

        function loadSetup(key) {
            const labels = ["é¢ˆæ¤ä½", "åŒè‚©è¿çº¿", "èƒ¸å»“ä¸­å¿ƒ", "è…¹ç›´è‚Œ", "éª¨ç›†ä¸­å¿ƒ", "è†å…³èŠ‚"];
            let hL = '', hR = '';
            labels.forEach(l => {
                hL += `<div class="param-card card-l"><label>${l}</label><b>8.5cm</b></div>`;
                hR += `<div class="param-card card-r"><label>${l}</label><b>2.1cm</b><div class="diff-tag">-6.4</div></div>`;
            });
            document.getElementById('colL').innerHTML = hL; document.getElementById('colR').innerHTML = hR;
            // è‡ªåŠ¨æ ¡æ­£ï¼šé’ˆå¯¹ä¸åŒç±»å‹è®¾ç½®ä¸åŒçš„åˆå§‹é»„é‡‘æ¯”ä¾‹ç‚¹
            if(key === 'shoulder') anchors = [0.12, 0.20, 0.28, 0.35, 0.15, 0.40];
            else anchors = [0.15, 0.25, 0.40, 0.55, 0.70, 0.85];
            draw();
        }

        function processImg(input, targetId) {
            if (input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    document.getElementById(targetId).style.backgroundImage = `url('${e.target.result}')`;
                    // è‡ªåŠ¨æ ¡æ­£è§¦å‘ï¼šå›¾ç‰‡ä¸Šä¼ åé‡ç½®é”šç‚¹è‡³é»„é‡‘ä½ç½®
                    draw(); 
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function saveData() {
            const name = prompt("å­˜æ¡£åç§°"); if(!name) return;
            const vault = JSON.parse(localStorage.getItem('LUX_PRO_V3') || '[]');
            vault.unshift({ id: Date.now(), name, anchors: [...anchors], imgB: document.getElementById('layB').style.backgroundImage, imgA: document.getElementById('layA').style.backgroundImage });
            localStorage.setItem('LUX_PRO_V3', JSON.stringify(vault)); renderVault();
        }

        function loadVault(id) {
            const item = JSON.parse(localStorage.getItem('LUX_PRO_V3')).find(x => x.id === id);
            if(item) {
                anchors = item.anchors;
                document.getElementById('layB').style.backgroundImage = item.imgB;
                document.getElementById('layA').style.backgroundImage = item.imgA;
                draw();
            }
        }

        function renderVault() {
            const v = JSON.parse(localStorage.getItem('LUX_PRO_V3') || '[]');
            document.getElementById('archiveBox').innerHTML = v.map(i => `<div style="background:#161e2e; padding:8px; margin-top:5px; border-radius:5px; display:flex; justify-content:space-between;"><span>${i.name}</span><button onclick="loadVault(${i.id})">è½½å…¥</button></div>`).join('');
        }

        document.getElementById('fadeSlider').oninput = e => {
            document.getElementById('layA').style.opacity = e.target.value / 100;
            document.getElementById('layB').style.opacity = 1 - (e.target.value / 100);
        };

        window.onload = () => { loadSetup('posture'); renderVault(); };
    </script>
</body>
</html>
