<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LUXIOU | æ™ºèƒ½ç—›ç‚¹ç­›æŸ¥çŸ©é˜µ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #00f2fe; --accent: #00ff88; --danger: #ff007a; --bg: #090b14; --surface: #121826; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; margin: 0; padding: 0; }
        
        /* æå‡æ•´ä½“å­—ä½“æ¸²æŸ“æ¸…æ™°åº¦ */
        body { background: var(--bg); color: #e2e8f0; font-family: "DIN Alternate", -apple-system, sans-serif; display: flex; flex-direction: column; height: 100svh; overflow: hidden; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        #capture-area { background: var(--bg); display: flex; flex-direction: column; height: 100%; width: 100%; }

        .header-brand { flex: 0 0 60px; width: 100%; display: flex; align-items: center; justify-content: center; background: rgba(9, 11, 20, 0.95); z-index: 50; border-bottom: 1px solid rgba(0,242,254,0.3); }
        .brand-text { font-size: 18px; font-weight: 900; color: #fff; letter-spacing: 2px; text-shadow: 0 0 8px rgba(0,242,254,0.6); }
        .step-badge { position: absolute; right: 15px; background: rgba(0,242,254,0.1); border: 1px solid var(--primary); color: var(--primary); font-size: 10px; padding: 4px 8px; border-radius: 12px; font-weight: bold; }

        .radar-section { flex: 0 0 250px; position: relative; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle at center, rgba(18, 24, 38, 0.9) 0%, var(--bg) 100%); border-bottom: 1px solid rgba(255,255,255,0.05); }
        #radarCanvas { width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 1; }
        
        .risk-panel { position: absolute; left: 20px; top: 20px; z-index: 2; display: flex; flex-direction: column; }
        .risk-label { font-size: 11px; color: #94a3b8; font-weight: 900; letter-spacing: 1px; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
        /* åˆ†æ•°è¶…é«˜æ¸…é”åŒ– */
        .risk-score { font-size: 42px; font-weight: 900; color: var(--accent); text-shadow: 0 0 10px rgba(0,255,136,0.5), 0 2px 4px rgba(0,0,0,0.8); transition: color 0.3s; line-height: 1; margin-top: 6px; }
        .risk-score.high { color: var(--danger); text-shadow: 0 0 15px rgba(255,0,122,0.6), 0 2px 4px rgba(0,0,0,0.8); }

        .matrix-scroll { flex: 1; overflow-y: auto; padding: 20px 15px 110px 15px; scrollbar-width: none; }
        .matrix-scroll::-webkit-scrollbar { display: none; }
        
        .question-group { margin-bottom: 25px; }
        .q-title { font-size: 14px; font-weight: 900; color: #fff; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .q-title::before { content: ''; display: block; width: 4px; height: 14px; background: var(--primary); border-radius: 2px; box-shadow: 0 0 8px var(--primary); }
        
        .tags-grid { display: flex; flex-wrap: wrap; gap: 10px; }
        .tag-btn { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(255,255,255,0.1); color: #94a3b8; padding: 10px 14px; border-radius: 12px; font-size: 12px; font-weight: bold; transition: all 0.2s; }
        .tag-btn.active { background: rgba(0, 242, 254, 0.1); border-color: var(--primary); color: #fff; box-shadow: 0 0 12px rgba(0,242,254,0.3); transform: scale(1.03); }
        .tag-btn.danger.active { background: rgba(255, 0, 122, 0.15); border-color: var(--danger); box-shadow: 0 0 15px rgba(255,0,122,0.4); }
        .tag-btn.custom-add { border: 1px dashed #64748b; color: #94a3b8; background: transparent; display: flex; align-items: center; justify-content: center; width: 100%; padding: 12px;}
        .tag-btn.custom-add:active { background: rgba(255,255,255,0.05); }

        .bottom-action { position: fixed; bottom: 0; left: 0; width: 100%; padding: 15px 20px 25px 20px; background: linear-gradient(to top, rgba(9,11,20,1) 60%, rgba(9,11,20,0)); z-index: 10; }
        .btn-generate { width: 100%; background: var(--primary); color: #000; border: none; padding: 16px; border-radius: 16px; font-size: 16px; font-weight: 900; box-shadow: 0 8px 25px rgba(0,242,254,0.3); display: flex; justify-content: center; align-items: center; gap: 8px; }

        .poster-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; padding: 20px; opacity: 0; transition: opacity 0.3s; }
        .poster-overlay.active { display: flex; opacity: 1; }
        .poster-scroll-area { max-height: 70vh; width: 100%; overflow-y: auto; border-radius: 12px; border: 2px solid var(--primary); box-shadow: 0 10px 40px rgba(0,242,254,0.3); }
        .poster-scroll-area::-webkit-scrollbar { display: none; }
        .poster-img { width: 100%; display: block; }
        .poster-tip { color: #fff; font-size: 15px; margin: 20px 0 15px 0; font-weight: bold; display: flex; align-items: center; gap: 8px; }
        .btn-next { background: #fff; color: #000; border: none; padding: 14px 35px; border-radius: 30px; font-weight: 900; font-size: 15px; box-shadow: 0 5px 20px rgba(255,255,255,0.2); }
    </style>
</head>
<body>

    <div id="capture-area">
        <div class="header-brand">
            <div class="brand-text">LUXIOU æ™ºèƒ½ç­›æŸ¥çŸ©é˜µ</div>
            <div class="step-badge">æ ¸å¿ƒä½“æµ‹æŠ¥å‘Š</div>
        </div>

        <div class="radar-section">
            <div class="risk-panel">
                <span class="risk-label">æœºèƒ½å¥åº·ç»¼åˆè¯„åˆ†</span>
                <div class="risk-score" id="scoreDisplay">95</div>
            </div>
            <canvas id="radarCanvas"></canvas>
        </div>

        <div class="matrix-scroll" id="scrollArea">
            
            <div class="question-group">
                <div class="q-title">ä¸€ã€æ‰€å±èŒä¸šä¸ä½œæ¯ (Occupation)</div>
                <div class="tags-grid">
                    <div class="tag-btn" data-impact='{"meta":-10, "posture":-15}' onclick="toggleTag(this)">ğŸ’» IT/äº’è”ç½‘/é‡‘è (æåº¦ä¹…å)</div>
                    <div class="tag-btn" data-impact='{"joint":-15, "muscle":-10}' onclick="toggleTag(this)">ğŸ‘¨â€ğŸ« åŒ»æŠ¤/æ•™å¸ˆ/é›¶å”® (é•¿æœŸä¹…ç«™)</div>
                    <div class="tag-btn" data-impact='{"meta":-15, "core":-5}' onclick="toggleTag(this)">ğŸ¥‚ é”€å”®/é«˜ç®¡ (åº”é…¬å¤š/å‹åŠ›å¤§)</div>
                    <div class="tag-btn custom-add" onclick="addCustomTag(this, '{\"meta\":-10, \"posture\":-10}', false, 'è¯·è¾“å…¥æ‚¨çš„ç‰¹æ®ŠèŒä¸šæˆ–ä½œæ¯ä¹ æƒ¯ï¼š')">â• å½•å…¥å…¶ä»–ç‰¹æ®ŠèŒä¸š/ä½œæ¯</div>
                </div>
            </div>

            <div class="question-group">
                <div class="q-title">äºŒã€é¥®é£Ÿä¸ä»£è°¢ (Metabolism)</div>
                <div class="tags-grid">
                    <div class="tag-btn" data-impact='{"meta":-20}' onclick="toggleTag(this)">ğŸ° é‡åº¦ç”œé£Ÿ/å¥¶èŒ¶æ§</div>
                    <div class="tag-btn" data-impact='{"meta":-15}' onclick="toggleTag(this)">ğŸ» é¢‘ç¹åº”é…¬/ç»å¸¸é¥®é…’</div>
                    <div class="tag-btn custom-add" onclick="addCustomTag(this, '{\"meta\":-15}', false, 'è¯·è¾“å…¥ç‰¹æ®Šé¥®é£Ÿåå¥½(å¦‚ï¼šé•¿æœŸèŠ‚é£Ÿ)ï¼š')">â• å½•å…¥å…¶ä»–ä¸è‰¯é¥®é£Ÿä¹ æƒ¯</div>
                </div>
            </div>

            <div class="question-group">
                <div class="q-title">ä¸‰ã€è¿åŠ¨ä¸ä¼¤ç—…å² (Sports & Injuries)</div>
                <div class="tags-grid">
                    <div class="tag-btn danger" data-impact='{"muscle":-20, "core":-10}' onclick="toggleTag(this, true)">ğŸš« å‡ ä¹é›¶è¿åŠ¨åŸºç¡€</div>
                    <div class="tag-btn danger" data-impact='{"core":-25, "posture":-10}' onclick="toggleTag(this, true)">ğŸ‘¼ äº§åæœªè¿›è¡Œç³»ç»Ÿåº·å¤</div>
                    <div class="tag-btn danger custom-add" onclick="addCustomTag(this, '{\"joint\":-25, \"muscle\":-15, \"core\":-10}', true, 'è¯·è¾“å…¥å…·ä½“ä¼¤ç—…(å¦‚ï¼šåŠæœˆæ¿æ’•è£‚/è…°çª)ï¼š')">â• å½•å…¥ç‰¹å¼‚æ€§ä¼¤ç—…æˆ–éª¨éª¼é—®é¢˜</div>
                </div>
            </div>

            <div class="question-group">
                <div class="q-title">å››ã€ç–¼ç—›ä¸ä¸é€‚ (Pain Points)</div>
                <div class="tags-grid">
                    <div class="tag-btn danger" data-impact='{"posture":-30, "joint":-10}' onclick="toggleTag(this, true)">âš¡ é¢ˆè‚©åƒµç¡¬é¢‘ç¹é…¸èƒ€</div>
                    <div class="tag-btn danger" data-impact='{"core":-25, "posture":-15}' onclick="toggleTag(this, true)">âš¡ ææ˜“è…°é…¸èƒŒç—›</div>
                    <div class="tag-btn danger custom-add" onclick="addCustomTag(this, '{\"joint\":-20, \"posture\":-15}', true, 'è¯·è¾“å…¥å…·ä½“ä¸é€‚éƒ¨ä½(å¦‚ï¼šè¶³åº•ç­‹è†œç‚)ï¼š')">â• å½•å…¥å…¶ä»–èº«ä½“ç–¼ç—›æ„Ÿ</div>
                </div>
            </div>

            <div class="question-group">
                <div class="q-title">äº”ã€é¦–è¦èœ•å˜ç›®æ ‡ (Primary Goal)</div>
                <div class="tags-grid">
                    <div class="tag-btn" data-goal="fatloss" onclick="toggleTag(this)">ğŸ”¥ æé€Ÿå‡è„‚å¡‘å½¢</div>
                    <div class="tag-btn" data-goal="posture" onclick="toggleTag(this)">ğŸ“ ä½“æ€ä¸éª¨éª¼çº æ­£</div>
                    <div class="tag-btn" data-goal="muscle" onclick="toggleTag(this)">ğŸ’ª å¢è‚Œä¸çº¿æ¡é›•åˆ»</div>
                    <div class="tag-btn" data-goal="postpartum" onclick="toggleTag(this)">ğŸ‘¼ äº§åç›†åº•è‚Œ/è…¹ç›´è‚Œä¿®å¤</div>
                    <div class="tag-btn" data-goal="health" onclick="toggleTag(this)">â¤ï¸ äºšå¥åº·è°ƒç†/å¿ƒè‚ºæå‡</div>
                    <div class="tag-btn" data-goal="shape" onclick="toggleTag(this)">ğŸ‘ å±€éƒ¨ç²¾é›• (ç›´è§’è‚©/èœœæ¡ƒè‡€/é©¬ç”²çº¿)</div>
                    <div class="tag-btn" data-goal="sport" onclick="toggleTag(this)">ğŸƒâ€â™‚ï¸ è¿åŠ¨è¡¨ç°æå‡ (é©¬æ‹‰æ¾/ä¸“é¡¹)</div>
                    <div class="tag-btn custom-add" onclick="addCustomTag(this, null, false, 'è¯·è¾“å…¥æ‚¨çš„ä¸ªæ€§åŒ–èœ•å˜ç›®æ ‡ï¼š')">â• å½•å…¥å…¶ä»–å®šåˆ¶ç›®æ ‡</div>
                </div>
            </div>

        </div>
    </div> 

    <div class="bottom-action" id="actionBtnGroup">
        <button class="btn-generate" onclick="generatePoster()">
            <span style="font-size: 20px;">ğŸ“¸</span> ç”ŸæˆæŠ¥å‘Šå¹¶ä¿å­˜ç›¸å†Œ
        </button>
    </div>

    <div class="poster-overlay" id="posterOverlay">
        <div class="poster-scroll-area"><img id="posterImg" class="poster-img" src="" alt="è¯Šæ–­æµ·æŠ¥"></div>
        <div class="poster-tip"><span style="color:var(--accent)">ğŸ‘‡ é•¿æŒ‰ä¸Šæ–¹å›¾ç‰‡ï¼Œä¿å­˜å®Œæ•´æ¡£æ¡ˆ</span></div>
        <button class="btn-next" onclick="goToNextStep()">è¿›å…¥ PAR-Q åŒ»ç–—æ’æŸ¥ â”</button>
    </div>

    <script>
        const canvas = document.getElementById('radarCanvas');
        const ctx = canvas.getContext('2d');
        const labels = ["æ ¸å¿ƒç¨³å®š", "å…³èŠ‚å¥åº·", "åŸºç¡€ä»£è°¢", "ä½“æ€æ’åˆ—", "è‚Œè‚‰å‡è¡¡"];
        const maxScore = 100;
        let currentScores = { core: 95, joint: 95, meta: 95, posture: 95, muscle: 95 };
        let targetScores = { core: 95, joint: 95, meta: 95, posture: 95, muscle: 95 };

        // ğŸš€ æ ¸å¿ƒè§†ç½‘è†œé«˜æ¸…ä¼˜åŒ– + æå…‰å¹»å½©è‰²
        function drawRadar() {
            // è·å–ç‰©ç†åƒç´ æ¯”ï¼Œæ ¹æ²»â€œå¤ªç³Šäº†â€çš„é—®é¢˜
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            const w = rect.width, h = rect.height;
            const centerX = w / 2 + 35; const centerY = h / 2;
            const radius = Math.min(w, h) / 2 * 0.65; const sides = 5;

            ctx.clearRect(0, 0, w, h);
            
            // åº•å›¾ç½‘æ ¼çº¿
            ctx.lineWidth = 1;
            for (let level = 1; level <= 4; level++) {
                ctx.beginPath();
                for (let i = 0; i < sides; i++) {
                    let angle = (Math.PI * 2 * i) / sides - Math.PI / 2;
                    let x = centerX + radius * (level / 4) * Math.cos(angle);
                    let y = centerY + radius * (level / 4) * Math.sin(angle);
                    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                }
                ctx.closePath();
                ctx.strokeStyle = `rgba(100, 116, 139, ${0.15 * level})`; ctx.stroke();
            }

            // æ ‡ç­¾
            ctx.fillStyle = "#cbd5e1"; ctx.font = "bold 12px sans-serif"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
            for (let i = 0; i < sides; i++) {
                let angle = (Math.PI * 2 * i) / sides - Math.PI / 2;
                let x = centerX + radius * Math.cos(angle); let y = centerY + radius * Math.sin(angle);
                ctx.beginPath(); ctx.moveTo(centerX, centerY); ctx.lineTo(x, y);
                ctx.strokeStyle = "rgba(255,255,255,0.05)"; ctx.stroke();
                let labelX = centerX + (radius + 25) * Math.cos(angle); let labelY = centerY + (radius + 15) * Math.sin(angle);
                ctx.fillText(labels[i], labelX, labelY);
            }

            // æ•°æ®å›¾å±‚
            ctx.beginPath();
            const keys = ['core', 'joint', 'meta', 'posture', 'muscle'];
            keys.forEach((key, i) => {
                let angle = (Math.PI * 2 * i) / sides - Math.PI / 2;
                let val = Math.max(20, currentScores[key]);
                let x = centerX + radius * (val / maxScore) * Math.cos(angle); let y = centerY + radius * (val / maxScore) * Math.sin(angle);
                if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            });
            ctx.closePath();
            
            let totalScore = Object.values(currentScores).reduce((a,b)=>a+b, 0) / 5;
            
            // æ›´æ¼‚äº®çš„æå…‰æ¸å˜è‰²
            let gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
            if(totalScore < 60) { 
                gradient.addColorStop(0, "rgba(255, 0, 122, 0.5)"); gradient.addColorStop(1, "rgba(255, 71, 87, 0.1)");
                ctx.fillStyle = gradient; ctx.strokeStyle = "#ff007a"; ctx.shadowColor = "#ff007a"; 
            } else { 
                gradient.addColorStop(0, "rgba(0, 242, 254, 0.5)"); gradient.addColorStop(1, "rgba(0, 255, 136, 0.1)");
                ctx.fillStyle = gradient; ctx.strokeStyle = "#00f2fe"; ctx.shadowColor = "#00f2fe"; 
            }
            
            ctx.shadowBlur = 15; ctx.lineWidth = 2.5; ctx.fill(); ctx.stroke(); ctx.shadowBlur = 0; 
        }

        function animate() {
            let needsUpdate = false;
            const keys = ['core', 'joint', 'meta', 'posture', 'muscle'];
            keys.forEach(key => {
                let diff = targetScores[key] - currentScores[key];
                if (Math.abs(diff) > 0.5) { currentScores[key] += diff * 0.15; needsUpdate = true; }
            });
            if (needsUpdate) { drawRadar(); updateTotalScore(); }
            requestAnimationFrame(animate);
        }

        function updateTotalScore() {
            let total = Object.values(currentScores).reduce((a,b)=>a+b, 0) / 5;
            let display = document.getElementById('scoreDisplay');
            display.innerText = Math.round(total);
            if(total < 60) display.classList.add('high'); else display.classList.remove('high');
        }

        function toggleTag(el, isDanger = false) {
            el.classList.toggle('active');
            if(isDanger && el.classList.contains('active')) el.classList.add('danger');
            recalculateScores();
        }

        // ğŸš€ å…¨é‡å¼€æ”¾çš„é€šç”¨æ‰‹åŠ¨å½•å…¥åŠŸèƒ½
        function addCustomTag(btn, defaultImpact, isDanger, promptText) {
            let text = prompt(promptText);
            if(text && text.trim() !== "") {
                let newTag = document.createElement('div');
                newTag.className = `tag-btn active ${isDanger ? 'danger' : ''}`;
                
                if(defaultImpact) { newTag.setAttribute('data-impact', defaultImpact); }
                else { newTag.setAttribute('data-goal', 'custom'); }
                
                newTag.innerHTML = `${isDanger ? 'âš ï¸' : 'âœ¨'} ${text.trim()}`;
                newTag.onclick = function() { toggleTag(this, isDanger); };
                
                btn.parentNode.insertBefore(newTag, btn);
                recalculateScores();
            }
        }

        function recalculateScores() {
            let newScores = { core: 95, joint: 95, meta: 95, posture: 95, muscle: 95 };
            document.querySelectorAll('.tag-btn.active').forEach(tag => {
                let impactStr = tag.getAttribute('data-impact');
                if(impactStr) { let impact = JSON.parse(impactStr); for(let key in impact) newScores[key] += impact[key]; }
                if(!impactStr && !tag.getAttribute('data-goal')) newScores.muscle -= 5;
            });
            targetScores = newScores;
        }

        function generatePoster() {
            let goals = []; document.querySelectorAll('.tag-btn.active[data-goal]').forEach(t => goals.push(t.innerText));
            if(goals.length === 0) { alert("è¯·è‡³å°‘åœ¨ç¬¬äº”é¡¹é€‰æ‹©ä¸€ä¸ªã€é¦–è¦èœ•å˜ç›®æ ‡ã€‘ï¼"); return; }
            if (navigator.vibrate) navigator.vibrate(50);
            
            let btn = document.querySelector('.btn-generate');
            btn.innerHTML = "â³ æ­£åœ¨æ¸²æŸ“å…¨æ™¯é«˜æ¸…é•¿å›¾..."; btn.style.opacity = "0.7"; document.getElementById('actionBtnGroup').style.display = 'none';
            
            let captureArea = document.getElementById('capture-area'); let scrollArea = document.getElementById('scrollArea');
            let origHeight = captureArea.style.height; let origOverflow = scrollArea.style.overflowY; let origFlex = scrollArea.style.flex;
            
            scrollArea.style.overflowY = 'visible'; scrollArea.style.flex = 'none'; captureArea.style.height = captureArea.scrollHeight + 'px';

            html2canvas(captureArea, { backgroundColor: "#090b14", scale: 2, windowHeight: captureArea.scrollHeight }).then(canvas => {
                captureArea.style.height = origHeight; scrollArea.style.overflowY = origOverflow; scrollArea.style.flex = origFlex;
                document.getElementById('actionBtnGroup').style.display = 'block'; btn.innerHTML = "<span style='font-size: 20px;'>ğŸ“¸</span> ç”ŸæˆæŠ¥å‘Šå¹¶ä¿å­˜ç›¸å†Œ"; btn.style.opacity = "1";
                document.getElementById('posterImg').src = canvas.toDataURL("image/jpeg", 0.9);
                document.getElementById('posterOverlay').classList.add('active');
            }).catch(err => {
                alert("ç”Ÿæˆé•¿å›¾å¤±è´¥ï¼Œè¯·é‡è¯•ï¼"); document.getElementById('actionBtnGroup').style.display = 'block';
                captureArea.style.height = origHeight; scrollArea.style.overflowY = origOverflow; scrollArea.style.flex = origFlex;
            });
        }

        function goToNextStep() { window.location.href = 'parq.html'; }
        window.onload = () => { drawRadar(); animate(); window.addEventListener('resize', drawRadar); };
    </script>
</body>
</html>
